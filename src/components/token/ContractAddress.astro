---
import QRCode from "qrcode";

interface Props {
	contractAddress?: string;
}

const { contractAddress } = Astro.props;

// Generate QR code as data URL if contract address is provided
// We'll generate a light version (black on white) which works well in both themes
let qrCodeDataUrl: string | null = null;
if (contractAddress) {
	try {
		qrCodeDataUrl = await QRCode.toDataURL(contractAddress, {
			width: 256,
			margin: 2,
			color: {
				dark: "#000000",
				light: "#FFFFFF",
			},
			errorCorrectionLevel: "M",
		});
	} catch (error) {
		console.error("Error generating QR code:", error);
	}
}
---

{contractAddress && qrCodeDataUrl && (
	<section class="contract-address-section">
		<h2 class="title mb-4 text-xl text-green-500">Contract Address</h2>
		<div class="mb-6 rounded-lg bg-black p-4 font-mono text-xs">
			<div class="grid grid-cols-2 gap-x-6 gap-y-3 md:grid-cols-4">
				<div>
					<span class="text-green-500/70">Token Name:</span>
					<code class="ml-2 text-green-500">COWSAYCO</code>
				</div>
				<div>
					<span class="text-green-500/70">Token Symbol:</span>
					<code class="ml-2 text-green-500">$COWSAY</code>
				</div>
				<div>
					<span class="text-green-500/70">Blockchain:</span>
					<code class="ml-2 text-green-500">Solana</code>
				</div>
				<div>
					<span class="text-green-500/70">Total Supply:</span>
					<code class="ml-2 text-green-500">945,000,000 (945M)</code>
				</div>
				<div>
					<span class="text-green-500/70">Circ. Supply:</span>
					<code class="ml-2 text-green-500">944.70M</code>
				</div>
				<div>
					<span class="text-green-500/70">Launch Platform:</span>
					<code class="ml-2 text-green-500">Pump.fun</code>
				</div>
				<div>
					<span class="text-green-500/70">Launch Mechanism:</span>
					<code class="ml-2 text-green-500">Bonding Curve</code>
				</div>
			</div>
		</div>
		<div class="flex flex-col md:flex-row gap-6 items-start md:items-center">
			<div class="flex-shrink-0">
				<img
					src={qrCodeDataUrl}
					alt="QR Code for Contract Address"
					class="w-48 h-48 border border-green-500/50 rounded-lg bg-black p-2"
				/>
			</div>
			<div class="flex-1 min-w-0">
				<p class="mb-2 text-sm text-green-500/80">Solana Contract Address:</p>
				<div class="flex items-center gap-2 flex-wrap">
					<code class="font-mono text-sm break-all bg-black text-green-500 px-3 py-2 rounded border border-green-500/50">
						{contractAddress}
					</code>
					<button
						id="copy-address-btn"
						class="px-3 py-2 text-sm rounded border border-green-500/50 bg-black text-green-500 hover:bg-green-500/10 transition-colors"
						aria-label="Copy contract address"
						data-address={contractAddress}
					>
						Copy
					</button>
				</div>
				<p class="mt-3 text-xs text-green-500/60">
					Scan the QR code or copy the address to add $COWSAY to your wallet
				</p>
			</div>
		</div>
	</section>
)}

{contractAddress && (
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const copyBtn = document.getElementById("copy-address-btn");

			if (copyBtn) {
				const addressToCopy = copyBtn.getAttribute("data-address");
				if (addressToCopy) {
					copyBtn.addEventListener("click", async function () {
						try {
							await navigator.clipboard.writeText(addressToCopy);
							const originalText = copyBtn.textContent;
							copyBtn.textContent = "Copied!";
							copyBtn.classList.add("bg-green-500/20");
							setTimeout(() => {
								copyBtn.textContent = originalText;
								copyBtn.classList.remove("bg-green-500/20");
							}, 2000);
						} catch (err) {
							console.error("Failed to copy:", err);
							copyBtn.textContent = "Failed";
							setTimeout(() => {
								copyBtn.textContent = "Copy";
							}, 2000);
						}
					});
				}
			}
		});
	</script>
)}

